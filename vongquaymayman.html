<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≤ng Quay May M·∫Øn T∆∞∆°ng T√°c</title>
    <!-- T·∫£i Tailwind CSS ƒë·ªÉ t·∫°o giao di·ªán hi·ªán ƒë·∫°i v√† responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#1e40af',
                        'primary-red': '#dc2626',
                        'primary-green': '#059669',
                        'primary-yellow': '#facc15',
                    }
                }
            }
        }
    </script>
    <style>
        /* ƒê·∫£m b·∫£o canvas n·∫±m gi·ªØa v√† chi·∫øm g·∫ßn h·∫øt kh√¥ng gian */
        #wheelCanvas {
            max-width: 90vmin; /* Gi·ªõi h·∫°n k√≠ch th∆∞·ªõc t·ªëi ƒëa theo viewport */
            max-height: 90vmin;
            touch-action: none; /* NgƒÉn ch·∫∑n h√†nh vi cu·ªôn m·∫∑c ƒë·ªãnh tr√™n touch devices */
        }
        /* Custom font cho s·ªë tr√™n v√≤ng quay */
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap');

        /* Animation cho n√∫t quay */
        @keyframes pulse-spin {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4 font-sans antialiased">

    <!-- Khu v·ª±c ch√≠nh c·ªßa ·ª©ng d·ª•ng -->
    <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-4xl text-center">
        <h1 class="text-3xl font-bold mb-4 text-primary-blue">
            üéâ V√≤ng Quay May M·∫Øn L·ªõp H·ªçc üéâ
        </h1>
        <p class="text-sm text-gray-600 mb-6">
            Nh·∫≠p s·ªë l∆∞·ª£ng h·ªçc sinh v√† nh·∫•n "Thi·∫øt L·∫≠p" tr∆∞·ªõc khi quay.
        </p>

        <!-- Thanh ƒëi·ªÅu khi·ªÉn -->
        <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-8 p-4 bg-gray-50 rounded-lg shadow-inner flex-wrap">
            <div class="flex items-center gap-2">
                <label for="studentCount" class="text-gray-700 font-medium whitespace-nowrap">S·ªë l∆∞·ª£ng STT (N):</label>
                <input type="number" id="studentCount" value="50" min="1" max="100" class="w-24 p-2 border border-gray-300 rounded-lg text-center focus:ring-primary-blue focus:border-primary-blue">
            </div>
            <button id="setupWheelBtn" class="bg-primary-green hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
                Thi·∫øt L·∫≠p V√≤ng Quay
            </button>
            <button id="spinBtn" class="bg-primary-red hover:bg-red-700 text-white font-extrabold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105"
                    style="animation: pulse-spin 2s infinite ease-in-out;">
                QUAY S·ªê!
            </button>
            
            <!-- N√∫t Lo·∫°i b·ªè s·ªë ƒë√£ quay M·ªöI -->
            <div class="flex items-center mt-2 md:mt-0">
                <input type="checkbox" id="excludeToggle" class="w-4 h-4 text-primary-blue bg-gray-100 border-gray-300 rounded focus:ring-primary-blue cursor-pointer">
                <label for="excludeToggle" class="ml-2 text-sm font-medium text-gray-700 select-none cursor-pointer whitespace-nowrap">Lo·∫°i b·ªè s·ªë ƒë√£ quay</label>
            </div>
        </div>

        <!-- Khu v·ª±c Canvas v√† K·∫øt qu·∫£ -->
        <div class="relative flex items-center justify-center">
            <!-- Canvas -->
            <canvas id="wheelCanvas" width="600" height="600" class="rounded-full shadow-2xl border-4 border-gray-300"></canvas>
            
            <!-- KIM CH·ªà C·ªê ƒê·ªäNH ƒë√£ ƒë∆∞·ª£c lo·∫°i b·ªè -->

            <!-- K·∫øt qu·∫£ Pop-up -->
            <div id="resultBox" class="absolute inset-0 bg-white/90 backdrop-blur-sm flex flex-col items-center justify-center rounded-xl shadow-2xl transform scale-0 opacity-0 transition-all duration-500 ease-out p-6" style="pointer-events: none;">
                <h2 class="text-4xl font-extrabold text-primary-blue mb-2">Xin Ch√∫c M·ª´ng!</h2>
                <p class="text-8xl font-black text-primary-red" id="resultNumber">?</p>
                <p class="text-2xl font-semibold text-primary-green mt-2">ƒê√£ ƒë∆∞·ª£c ch·ªçn!</p>
                <button id="closeResultBtn" class="mt-6 bg-primary-blue hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg">
                    Quay L·∫°i
                </button>
            </div>
        </div>

        <!-- Confetti Container -->
        <div id="confettiContainer" class="absolute inset-0 z-50 pointer-events-none"></div>

        <!-- Message/Alert Container (S·ª≠ d·ª•ng thay cho alert()) -->
        <div id="messageContainer" class="fixed top-0 inset-x-0 p-4 flex items-start justify-center opacity-0 transition-opacity duration-300 pointer-events-none z-[60]">
            <!-- N·ªôi dung message s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y -->
        </div>
        
    </div>
    
    <!-- Th√¥ng tin t√°c gi·∫£ ƒë∆∞·ª£c th√™m v√†o cu·ªëi c√πng, d∆∞·ªõi div ch√≠nh -->
    <p class="text-xs text-gray-500 mt-4 self-end mr-4 md:mr-0">
        Design by: phamthienthanh79.tqk.tmt
    </p>

    <!-- Script JavaScript ch√≠nh -->
    <script>
        // --- 1. Thi·∫øt l·∫≠p bi·∫øn to√†n c·ª•c ---
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const setupWheelBtn = document.getElementById('setupWheelBtn');
        const resultBox = document.getElementById('resultBox');
        const resultNumberDisplay = document.getElementById('resultNumber');
        const closeResultBtn = document.getElementById('closeResultBtn');
        const studentCountInput = document.getElementById('studentCount');
        const excludeToggle = document.getElementById('excludeToggle'); // Bi·∫øn m·ªõi
        const messageContainer = document.getElementById('messageContainer'); // Bi·∫øn m·ªõi

        let segments = 50; // S·ªë l∆∞·ª£ng l√°t c·∫Øt hi·ªán t·∫°i. S·∫Ω b·∫±ng availableSegments.length
        let availableSegments = []; // M·∫£ng ch·ª©a c√°c STT c√≤n l·∫°i (v√≠ d·ª•: [1, 2, 5, 8, ...])
        let colors = ['#facc15', '#dc2626', '#1e40af', '#059669', '#ef4444']; // V√†ng, ƒê·ªè, Xanh ƒë·∫≠m, Xanh l√°, ƒê·ªè t∆∞∆°i
        let spinAngle = 0; // G√≥c quay hi·ªán t·∫°i (t√≠ch l≈©y)
        let velocity = 0; // T·ªëc ƒë·ªô quay (g√≥c/frame)
        let isSpinning = false;
        let animationFrameId = null;
        let result = null;
        
        // Kh·ªüi t·∫°o bi·∫øn ƒë·ªÉ theo d√µi v·ªã tr√≠ cho √¢m thanh tick
        window.currentSegmentIndex = 0; 

        // --- H√†m hi·ªÉn th·ªã th√¥ng b√°o t·∫°m th·ªùi (Thay th·∫ø cho alert()) ---
        function showTemporaryMessage(message, duration = 3000, bgColor = 'bg-blue-500') {
            const messageEl = document.createElement('div');
            messageEl.className = `p-3 rounded-lg text-white font-semibold shadow-lg ${bgColor}`;
            messageEl.textContent = message;

            messageContainer.innerHTML = '';
            messageContainer.appendChild(messageEl);
            messageContainer.classList.remove('opacity-0');
            messageContainer.classList.add('opacity-100');

            setTimeout(() => {
                messageContainer.classList.remove('opacity-100');
                messageContainer.classList.add('opacity-0');
                // Ch·ªù transition k·∫øt th√∫c r·ªìi x√≥a n·ªôi dung
                setTimeout(() => {
                    messageContainer.innerHTML = '';
                }, 300); 
            }, duration);
        }

        // --- 2. X·ª≠ l√Ω √¢m thanh (Web Audio API c∆° b·∫£n) ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // √Çm thanh khi quay (Ti·∫øng "click/tick vui nh·ªôn")
        function playTickSound() {
            const now = audioContext.currentTime;
            const oscillator = audioContext.createOscillator();
            // S·ª≠ d·ª•ng s√≥ng vu√¥ng ho·∫∑c rƒÉng c∆∞a ƒë·ªÉ t·∫°o √¢m thanh s·∫Øc n√©t (nh∆∞ ti·∫øng click)
            oscillator.type = 'square'; 
            oscillator.frequency.setValueAtTime(700 + Math.random() * 200, now); // T·∫ßn s·ªë cao, ng·∫´u nhi√™n nh·∫π
            
            const gainNode = audioContext.createGain();
            gainNode.gain.setValueAtTime(0.15, now);
            gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.08); // Decay nhanh, √¢m thanh ng·∫Øn g·ªçn

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(now + 0.08); 
        }

        // √Çm thanh khi th·∫Øng (Fanfare/chu√¥ng)
        function playWinSound() {
            const now = audioContext.currentTime;
            
            // Note 1
            const osc1 = audioContext.createOscillator();
            const gain1 = audioContext.createGain();
            osc1.type = 'triangle';
            osc1.frequency.setValueAtTime(523.25, now); // C5
            gain1.gain.setValueAtTime(0.4, now);
            gain1.gain.exponentialRampToValueAtTime(0.0001, now + 0.5);
            osc1.connect(gain1).connect(audioContext.destination);
            osc1.start(now);
            osc1.stop(now + 0.5);

            // Note 2 slightly delayed
            const osc2 = audioContext.createOscillator();
            const gain2 = audioContext.createGain();
            osc2.type = 'triangle';
            osc2.frequency.setValueAtTime(659.25, now + 0.1); // E5
            gain2.gain.setValueAtTime(0.4, now + 0.1);
            gain2.gain.exponentialRampToValueAtTime(0.0001, now + 0.6);
            osc2.connect(gain2).connect(audioContext.destination);
            osc2.start(now + 0.1);
            osc2.stop(now + 0.6);
        }

        // --- 3. V·∫Ω v√≤ng quay tr√™n Canvas ---
        function drawWheel() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.9;
            // T√≠nh arc d·ª±a tr√™n s·ªë l∆∞·ª£ng segments HI·ªÜN C√ì
            const arc = segments > 0 ? Math.PI * 2 / segments : 0; 

            // X√≥a canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (segments === 0) {
                 // V·∫Ω m·ªôt v√≤ng tr√≤n tr·ªëng/x√°m n·∫øu kh√¥ng c√≤n segment n√†o
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.fillStyle = '#ccc';
                ctx.fill();
                ctx.strokeStyle = '#999';
                ctx.lineWidth = 4;
                ctx.stroke();
            }

            for (let i = 0; i < segments; i++) {
                const angle = spinAngle + i * arc;
                const segmentColor = colors[i % colors.length];
                const segmentNumber = availableSegments[i]; // L·∫•y s·ªë t·ª´ m·∫£ng c√≥ s·∫µn

                // V·∫Ω l√°t c·∫Øt
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, angle, angle + arc);
                ctx.lineTo(centerX, centerY);
                ctx.closePath();
                ctx.fillStyle = segmentColor;
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 4;
                ctx.stroke();

                // V·∫Ω ch·ªØ s·ªë
                ctx.save();
                ctx.translate(centerX, centerY);
                // G√≥c ƒë·∫∑t ch·ªØ s·ªë (·ªü gi·ªØa l√°t c·∫Øt)
                const textAngle = angle + arc / 2; 
                ctx.rotate(textAngle);

                // ƒê·∫∑t ch·ªØ s·ªë c√°ch t√¢m m·ªôt kho·∫£ng (v√≠ d·ª•: 80% b√°n k√≠nh)
                ctx.fillStyle = 'black'; 
                ctx.font = 'bold 18px "Luckiest Guy", sans-serif'; 
                ctx.textAlign = 'right';
                ctx.fillText(segmentNumber.toString(), radius * 0.9, 5); // ƒê·∫∑t ch·ªØ s·ªë xa t√¢m h∆°n (0.9)

                ctx.restore();
            }

            // V·∫Ω v√≤ng tr√≤n nh·ªè ·ªü trung t√¢m
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.15, 0, Math.PI * 2);
            ctx.fillStyle = 'white';
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.stroke();
        }

        // --- 4. Thi·∫øt l·∫≠p V√≤ng quay m·ªõi ---
        function setupWheel() {
            let count = parseInt(studentCountInput.value, 10);
            if (isNaN(count) || count < 1 || count > 100) {
                console.error("S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá. Thi·∫øt l·∫≠p l·∫°i 50.");
                count = 50;
                studentCountInput.value = 50;
            }
            
            // T√°i t·∫°o m·∫£ng s·ªë th·ª© t·ª± c√≥ s·∫µn (1 ƒë·∫øn N)
            availableSegments = Array.from({ length: count }, (_, i) => i + 1);
            
            segments = availableSegments.length;
            spinAngle = 0; // ƒê·∫∑t l·∫°i spinAngle khi thi·∫øt l·∫≠p l·∫°i v√≤ng quay ho√†n to√†n
            drawWheel();
        }

        // --- 5. Logic quay v√† D·ª´ng ---
        
        function animateWheel() {
            // C·∫≠p nh·∫≠t g√≥c quay
            spinAngle += velocity;
            spinAngle %= (Math.PI * 2);

            // Gi·∫£m t·ªëc ƒë·ªô (Ma s√°t)
            velocity *= 0.992; 

            // Ki·ªÉm tra t·ªëc ƒë·ªô d·ª´ng
            if (isSpinning && velocity < 0.005) {
                velocity = 0;
                isSpinning = false;
                cancelAnimationFrame(animationFrameId);
                handleStop();
                return;
            }

            drawWheel();
            animationFrameId = requestAnimationFrame(animateWheel);
        }

        function startSpin() {
            if (isSpinning) return;

            // Ki·ªÉm tra n·∫øu h·∫øt s·ªë ƒë·ªÉ quay
            if (segments === 0) {
                showTemporaryMessage("V√≤ng quay ƒë√£ h·∫øt s·ªë ƒë·ªÉ ch·ªçn!", 3000, 'bg-yellow-500');
                return;
            }

            // ·∫®n k·∫øt qu·∫£ n·∫øu ƒëang hi·ªÉn th·ªã
            hideResult();

            isSpinning = true;
            spinBtn.disabled = true;
            setupWheelBtn.disabled = true;

            // T·∫°o v·∫≠n t·ªëc ban ƒë·∫ßu ng·∫´u nhi√™n l·ªõn (ƒë·∫£m b·∫£o quay v√†i v√≤ng)
            velocity = Math.random() * 0.1 + 0.3; 
            
            // ƒê·∫∑t l·∫°i index tick sound
            window.currentSegmentIndex = -1;

            // T√≠nh g√≥c d·ª´ng m·ª•c ti√™u ng·∫´u nhi√™n
            const randomIndexInArray = Math.floor(Math.random() * segments); // Ch·ªçn index trong m·∫£ng availableSegments
            
            // G√°n k·∫øt qu·∫£ ƒë·ªÉ hi·ªÉn th·ªã sau khi d·ª´ng. result l√† STT, kh√¥ng ph·∫£i index.
            result = availableSegments[randomIndexInArray]; 
            
            // LOGIC T√çNH TO√ÅN G√ìC ƒê√çCH ƒê√É ƒê∆Ø·ª¢C CH·ªàNH S·ª¨A
            const arc = Math.PI * 2 / segments;

            // 1. G√≥c ƒë√≠ch mong mu·ªën (normalized, 0 ƒë·∫øn 2*PI). 
            // V·ªã tr√≠ 0 radian (b√™n ph·∫£i) l√† ƒëi·ªÉm d·ª´ng.
            const targetSegmentCenterAngle = randomIndexInArray * arc + arc / 2;
            const A_dest_normalized = (Math.PI * 2) - targetSegmentCenterAngle; 

            // 2. G√≥c hi·ªán t·∫°i c·ªßa v√≤ng quay (normalized, 0 ƒë·∫øn 2*PI)
            let A_normalized = spinAngle % (Math.PI * 2);
            if (A_normalized < 0) A_normalized += Math.PI * 2; 

            // 3. G√≥c quay th√™m c·∫ßn thi·∫øt ƒë·ªÉ ƒë·∫°t ƒë·∫øn ƒë√≠ch (sau khi quay h·∫øt v√≤ng quay hi·ªán t·∫°i)
            // ƒê·∫£m b·∫£o A_diff lu√¥n d∆∞∆°ng v√† l√† qu√£ng ƒë∆∞·ªùng ng·∫Øn nh·∫•t ƒë·ªÉ ƒë·∫øn A_dest_normalized
            let A_diff = (A_dest_normalized - A_normalized + Math.PI * 2) % (Math.PI * 2);
            
            // 4. Th√™m s·ªë v√≤ng quay t·ªëi thi·ªÉu
            const minSpins = 5; 
            const extraSpins = (Math.floor(Math.random() * 4) + minSpins) * (Math.PI * 2); // 5 ƒë·∫øn 8 v√≤ng quay

            // 5. G√≥c ƒë√≠ch tuy·ªát ƒë·ªëi
            let targetAngle = spinAngle + extraSpins + A_diff; 
            
            // B·∫Øt ƒë·∫ßu animation
            animationFrameId = requestAnimationFrame(() => controlledSpin(targetAngle));
        }

        // C·∫£i ti·∫øn animation ƒë·ªÉ ƒë·∫£m b·∫£o d·ª´ng ƒë√∫ng v·ªã tr√≠
        function controlledSpin(targetAngle) {
            if (!isSpinning) return;
            
            spinAngle += velocity;
            
            // LOGIC PH√ÅT √ÇM THANH TICK
            const arc = segments > 0 ? Math.PI * 2 / segments : Math.PI * 2;
            let currentAngleNormalized = spinAngle % (Math.PI * 2);
            if (currentAngleNormalized < 0) {
                currentAngleNormalized += Math.PI * 2;
            }
            
            const currentSegmentIndex = Math.floor(currentAngleNormalized / arc);

            if (currentSegmentIndex !== window.currentSegmentIndex) {
                playTickSound();
                window.currentSegmentIndex = currentSegmentIndex;
            }
            
            // T√≠nh to√°n kho·∫£ng c√°ch ƒë·∫øn ƒëi·ªÉm d·ª´ng (d·ª±a tr√™n g√≥c ƒë√≠ch ƒë√£ quay nhi·ªÅu v√≤ng)
            let distance = targetAngle - spinAngle;
            
            // √Åp d·ª•ng l·ª±c h√£m theo kho·∫£ng c√°ch (H√£m m·∫°nh h∆°n khi g·∫ßn ƒë√≠ch)
            if (distance < Math.PI * 4) { // Kho·∫£ng 2 v√≤ng quay cu·ªëi
                velocity = Math.max(0.001, velocity * 0.999); // Gi·∫£m t·ªëc nh·∫π
                
                if (distance < Math.PI * 1) { // V√≤ng quay cu·ªëi c√πng
                     velocity = Math.max(0.001, velocity * 0.99); // Gi·∫£m t·ªëc m·∫°nh h∆°n
                }

                if (distance < 0.005) { // Qu√° ƒë√≠ch ho·∫∑c r·∫•t g·∫ßn
                    velocity = 0;
                    isSpinning = false;
                    handleStop();
                    return;
                }
            } else {
                velocity *= 0.9999; // Gi·ªØ t·ªëc ƒë·ªô cao
            }

            drawWheel();
            animationFrameId = requestAnimationFrame(() => controlledSpin(targetAngle));
        }


        function handleStop() {
            if (result !== null) {
                showResult(result);
                playWinSound();
                createConfetti();

                // LOGIC M·ªöI: Lo·∫°i b·ªè s·ªë ƒë√£ quay n·∫øu toggle ƒë∆∞·ª£c ch·ªçn
                if (excludeToggle.checked) {
                    const indexToRemove = availableSegments.indexOf(result);
                    if (indexToRemove > -1) {
                        availableSegments.splice(indexToRemove, 1);
                        // C·∫≠p nh·∫≠t l·∫°i s·ªë l∆∞·ª£ng segments v√† v·∫Ω l·∫°i
                        segments = availableSegments.length; 
                        
                        // C·∫≠p nh·∫≠t spinAngle ƒë·ªÉ gi·ªØ v√≤ng quay ·ªü v·ªã tr√≠ tr·ª±c quan t·ªët
                        // Sau khi lo·∫°i b·ªè 1 segment, c√°c segment c√≤n l·∫°i "nh·∫£y" v·ªã tr√≠. C·∫ßn v·∫Ω l·∫°i.
                        drawWheel(); 
                        
                        // Th√¥ng b√°o n·∫øu h·∫øt s·ªë
                        if (segments === 0) {
                            showTemporaryMessage("ƒê√£ g·ªçi h·∫øt t·∫•t c·∫£ h·ªçc sinh!", 5000, 'bg-red-600');
                        }
                    }
                }
                
                // Cho ph√©p quay l·∫°i sau 2 gi√¢y
                setTimeout(() => {
                    spinBtn.disabled = false;
                    setupWheelBtn.disabled = false;
                }, 2000);
            }
        }

        // --- 6. X·ª≠ l√Ω K·∫øt qu·∫£ v√† Hi·ªáu ·ª©ng Ph√°o gi·∫•y ---

        function showResult(num) {
            resultNumberDisplay.textContent = num;
            resultBox.classList.remove('scale-0', 'opacity-0');
            resultBox.classList.add('scale-100', 'opacity-100');
            resultBox.style.pointerEvents = 'auto';
        }

        function hideResult() {
            resultBox.classList.remove('scale-100', 'opacity-100');
            resultBox.classList.add('scale-0', 'opacity-0');
            resultBox.style.pointerEvents = 'none';
        }

        closeResultBtn.addEventListener('click', hideResult);

        // T·∫°o hi·ªáu ·ª©ng Confetti (Ph√°o gi·∫•y)
        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            const colorsConfetti = ['#f00', '#00f', '#0f0', '#ff0', '#f0f', '#0ff'];
            const numberOfPieces = 50;

            for (let i = 0; i < numberOfPieces; i++) {
                const piece = document.createElement('div');
                piece.style.width = piece.style.height = `${Math.random() * 10 + 5}px`;
                piece.style.backgroundColor = colorsConfetti[Math.floor(Math.random() * colorsConfetti.length)];
                piece.style.position = 'absolute';
                piece.style.borderRadius = '2px';
                
                // V·ªã tr√≠ ban ƒë·∫ßu (tr√™n c√πng gi·ªØa)
                piece.style.left = `${50 + (Math.random() - 0.5) * 20}%`; 
                piece.style.top = '0%';
                
                // Animation
                const animationDuration = Math.random() * 2 + 3; // 3 ƒë·∫øn 5 gi√¢y
                const translateX = (Math.random() - 0.5) * 500; // Ngang
                const translateY = window.innerHeight * 1.5; // D·ªçc

                piece.animate([
                    { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                    { transform: `translate(${translateX}px, ${translateY}px) rotate(${Math.random() * 1080}deg)`, opacity: 0.5 }
                ], {
                    duration: animationDuration * 1000,
                    easing: 'ease-out',
                    fill: 'forwards'
                });

                container.appendChild(piece);

                // X√≥a m·∫£nh ph√°o gi·∫•y sau khi animation k·∫øt th√∫c
                setTimeout(() => piece.remove(), animationDuration * 1000);
            }
        }

        // --- 7. Thi·∫øt l·∫≠p s·ª± ki·ªán v√† Kh·ªüi t·∫°o ---

        spinBtn.addEventListener('click', startSpin);
        setupWheelBtn.addEventListener('click', setupWheel);

        // Kh·ªüi t·∫°o k√≠ch th∆∞·ªõc canvas v√† v·∫Ω v√≤ng quay ban ƒë·∫ßu
        window.onload = function () {
            // ƒê·∫£m b·∫£o canvas c√≥ k√≠ch th∆∞·ªõc vu√¥ng, responsive
            const size = Math.min(window.innerWidth, window.innerHeight) * 0.7;
            canvas.width = size;
            canvas.height = size;
            setupWheel();
        }

        // X·ª≠ l√Ω responsive khi c·ª≠a s·ªï thay ƒë·ªïi k√≠ch th∆∞·ªõc
        window.addEventListener('resize', () => {
            const size = Math.min(window.innerWidth, window.innerHeight) * 0.7;
            canvas.width = size;
            canvas.height = size;
            drawWheel();
        });

        // Cho ph√©p d√πng ph√≠m Enter ƒë·ªÉ quay
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !isSpinning && !studentCountInput.matches(':focus')) {
                startSpin();
            }
        });

    </script>
</body>
</html>
